{% extends 'base.html'%}
{% load static%}
{% block content %}

<!--Navbar-->
{% include 'navbar.html'%}

<!--Body-->
<div class="main-part clearfix">
    <div class="post-and-story">
        <div class="stories">

            {% for story in stories %}
                <div class="story">
                        <img src="{{ story.stories_info.0.story_path }}" class="story-photo" onclick="modalTheimage({{story.stories_info| safe}}, '{{story.storier_name}}', '{{story.storier_id}}', '{{ story.mediaCount}}')">
                        <div class="storier_photo">
                            <a href=""><img src="{{ story.storier_photo }}"></a>
                        </div>
                </div>
            {% endfor %}

        </div>

        <!-- Post section -->

        {% for post in posts %}
            <div class="post">
                <div class="poster clearfix">
                    <div class="photo-box">
                        <a href="{% url 'profile' post.poster_id %}"><img src="{{ post.poster_photo }}" alt="identity" class="photo"></a>
                    </div>
                    
                    <div class="name">
                        <a href="{% url 'profile' post.poster_id %}">{{post.poster_name}}</a>
                    </div>
                </div>

                <div class="caption">
                    {{post.caption}}
                </div>

                {% if post.mediaCount|length > 0%}
                <div class="media">

                    {% for photo in post.photos %}
                        {% if forloop.counter == 1 %}
                            <img src="{{ photo }}" class="post-photo-in-post" style="display: block !important;" ondblclick="likes('{{post.user_id}}', '{{post.post_id}}', document.getElementsByClassName('like-for-post')[0])" />
                        {% else %}
                            <img src="{{ photo }}" class="post-photo-in-post" ondblclick="likes('{{post.user_id}}', '{{post.post_id}}', document.getElementsByClassName('like-for-post')[0])" />
                        {% endif %}
                    {% endfor %}
        
                    {% for video in post.videos %}
                        {% if post.photos|length == 0 and forloop.counter == 1 %}
                            <video class="post-video-in-post" src ="{{ video }}" style="display: block !important;" controls></video>
                        {% else %}
                            <video class="post-video-in-post" src="{{video}}" controls></video>
                        {% endif %}
                    {% endfor %}
        
                    <a class="button-in-post prev" onclick="slideMedia(this, {{ post.photos }}, {{ post.videos }}, -1)">&#10094;</a>
                    {% if post.mediaCount|length > 1 %}
                    <a class="button-in-post next" onclick="slideMedia(this, {{ post.photos }}, {{ post.videos }}, 1)">&#10095;</a>
                    {% endif %}
        
                    <div class="dot-container-on-media">
                        {% for i in post.mediaCount %}
        
                            {% if forloop.counter == 1  %}
                                <span class="dot-on-media" style="background-color:deepskyblue;"></span>
                            {% else %}
                                <span class="dot-on-media" style="background-color:#bbb"></span>
                            {% endif %}
        
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <div class="post_icons">
                    {% csrf_token %}
                    <ul class="icons clearfix">
                        {% if post.isLike %}
                            <li><i class="fa fa-heart like-for-post" aria-hidden="true" onclick="likes('{{post.user_id}}', '{{post.post_id}}', this)"></i></li>
                        {% else %}
                            <li><i class="fa fa-heart-o like-for-post" aria-hidden="true" onclick="likes('{{post.user_id}}', '{{post.post_id}}', this)"></i></li>
                        {% endif %}
                        <li><a href="{% url 'post' post.post_id %}"><i class="fa fa-comment-o" aria-hidden="true"></i></a></li>
                        <li><i class="fa fa-paper-plane-o" aria-hidden="true"></i></li>
                        {% if post.isSave %}
                            <li><i class="fa fa-bookmark" aria-hidden="true" onClick="saved('{{post.user_id}}', '{{post.post_id}}', this)"></i></li>
                        {% else %}
                            <li><i class="fa fa-bookmark-o" aria-hidden="true" onClick="saved('{{post.user_id}}', '{{post.post_id}}', this)"></i></li>
                        {% endif %}
                    </ul>
                </div>



                <!--MY change 1: showing liked user list-->

                <div class="text">
                    <button class="like_list_show_button" id="like_list_show_button" onclick="like_list('{{ post.user_id }}','{{ post.post_id }}', this)" >{{ post.total_likes }} likes</button>
                </div>


                <!--MY change 1 end-->
                {% if post.comment_count %}
                <div class="text">
                    <a href="{% url 'post' post.post_id %}" target="_blank" class="index-view-all-comments" >
                        View all &nbsp;<div>{{ post.comment_count}}</div> comments
                    </a>
                </div>
                {% endif %}
                <div class="comments">
                    {% for comment in post.comments%}
                        {% if forloop.counter == 1 or forloop.counter == 2 %}
                        <div class="index-comment-element clearfix">
                            <div class="index-comment-comment">
                                <a href="{% url 'profile' comment.commenter_id%}">@{{ comment.commenter_username}}</a> {{comment.comment_text}}
                            </div>
                            {% csrf_token %}

                            <div class="index-comment-element-like">
                                <ul class="icons clearfix">
                                    {% if comment.comment_is_like %}
                                        <li><i class="fa fa-heart" aria-hidden="true" onclick="likes('{{ user_id }}','{{ comment.comment_id }}', this, 'CMNT')"></i></li>
                                    {% else %}
                                        <li><i class="fa fa-heart-o" aria-hidden="true" onclick="likes('{{ user_id }}','{{ comment.comment_id }}', this, 'CMNT')"></i></li>
                                    {% endif %}
                                </ul>
                            </div>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>

                <div class="index-post-age">
                    {{ post.age}}
                </div>

                <div class="add-comment clearfix">
                    {% csrf_token %}
                    <input type="text" placeholder="Add your comment" onkeyup="change_color_of_post_button(this)">
                    <button type="submit" onclick="addCommentIndex(this, '{{ user_id }}', '{{ post.post_id }}')" disabled>Post</button>
                </div>
            </div>
        {% endfor %}

            <!-- like list -->
            <div class="like_list_container" id="like_list_container" onclick="close_list()">
                <div class="like_list_inner_container" id="like_list_inner_container" onclick="inner_container_stop_propagation()">
                    <div class="like_list_top_bar" id="like_list_top_bar">
                        <h2>Likes</h2>
                        <img onclick="close_list()" src="{% static 'resources/img/close.jpg'%}" >
                    </div>
                    <hr />
                    <div class="like_list_content" id="like_list_content">
                        <ul class="list_of_liked_users" id="list_of_liked_users">
                        </ul>
                    </div>
                </div>
            </div>
            <!-- like list done -->
        <!-- Post section done -->

    </div>

    <div id="myModal" class="modal"></div>

    <div class="optional">
        <div class="profile clearfix">
            <div class="photo-box">
                <img src="{{ user_photo }}" alt="fa" class="photo">
            </div>
            <div class="name secname">
                <a href="{% url 'profile' user_id %}">{{ name }}</a>
                <div class="">{{ username }}</div>
            </div>
        </div>
        <div class="suggestions">
            <div class="header clearfix">
                <div class="suggested">Suggested For You</div>
                <div class="see-all"><a href="{% url 'suggestions' %}">See all</a></div>
            </div>
            <div class="body">
                {% for s in suggestions %}
                    <div class="person clearfix">
                        <div class="photo-box">
                            <img src="{{ s.sugges_photo }}" class="photo">
                        </div>
                        <div class="name">
                            <a href="{% url 'profile' s.sugges_id %}">{{ s.sugges_name}}</a>
                        </div>
                        <div class="follow">
                            {%csrf_token%}
                            {% if user_id != s.sugges_id %}
                                {% if s.isFollower %}
                                    <button onClick="follow(this, '{{ user_id}}', '{{ s.sugges_id }}', 1)">Follow back</button>
                                {% else %}
                                    <button onClick="follow(this, '{{ user_id}}', '{{ s.sugges_id }}', 1)">Follow</button>
                                {% endif %}
                            {% endif %} 
                        </div>
                    </div>
                {% endfor %}
                
            </div>
        </div>
        <div class="footer">

        </div>
    </div>
</div>
{% endblock %}

