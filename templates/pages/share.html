{% extends 'base.html' %}
{% load static %}


{%block title%}
    {{ post_id }}
{%endblock%}


{% block content %}
{% include 'navbar.html' %}

    <div class="post-container-in-post">
        <div class="media-in-post" >

            {% for photo in post.photos %}
                {% if forloop.counter == 1 %}
                    <img src="{{ photo }}" class="post-photo-in-post" style="display: block !important;" ondblclick="likes('{{user_id}}', '{{shared_id}}', document.getElementsByClassName('like-for-post')[0], 'SHR')" />
                {% else %}
                    <img src="{{ photo }}" class="post-photo-in-post" ondblclick="likes('{{user_id}}', '{{shared_id}}', document.getElementsByClassName('like-for-post')[0], 'SHR')" />
                {% endif %}
            {% endfor %}

            {% for video in post.videos %}
                {% if post.photos|length == 0 and forloop.counter == 1 %}
                    <video class="post-video-in-post" src ="{{ video }}" style="display: block !important;" controls></video>
                {% else %}
                    <video class="post-video-in-post" src ="{{ video }}" controls></video>
                {% endif %}
            {% endfor %}

            <a class="button-in-post prev" onclick="slideMedia(this, {{ post.photos }}, {{ post.videos }}, -1)">&#10094;</a>
            {% if post.mediaCount|length > 1 %}
            <a class="button-in-post next" onclick="slideMedia(this, {{ post.photos }}, {{ post.videos }}, 1)">&#10095;</a>
            {% endif %}

            <div class="dot-container-on-media">
                {% for i in post.mediaCount %}

                    {% if forloop.counter == 1  %}
                        <span class="dot-on-media" style="background-color:deepskyblue;"></span>
                    {% else %}
                        <span class="dot-on-media" style="background-color:#bbb"></span>
                    {% endif %}

                {% endfor %}
            </div>
        </div>

        <div class="right-side-of-post">
            <div class="top-bar-of-post-right">
                <a href="{% url 'profile' sharer_id %}"><img src="{{ sharer_profile }}" alt="identity" class="profile-photo-in-topbar"></a>
                <h3><a href="{% url 'profile' sharer_id %}">{{ sharer_username }}</a></h3>

                {% if user_id != sharer_id %}
                    {% if post.isFollowee %}
                        <button class="follow_button_in_post_view" onclick="follow(this, '{{ user_id }}', '{{ sharer_id }}')">Unfollow</button>
                    {% elif post.isFollower %}
                        <button class="follow_button_in_post_view" onclick="follow(this, '{{ user_id }}', '{{ sharer_id }}')">Follow Back</button>
                    {% else %}
                        <button class="follow_button_in_post_view" onclick="follow(this, '{{ user_id }}', '{{ sharer_id }}')">Follow</button>
                    {% endif %}
                {% endif %}

                {% if sharer_id == user_id %}
                    {% csrf_token %}
                    <button type="button" class="delete-button delete-button-post" onclick="deleteContent(document.getElementsByClassName('post-container-in-post')[0], {{shared_id}}, 'SHR')">
                        <span aria-hidden="true" class="delete-button-icon">&times;</span>
                    </button>
                {% endif %}

            </div>

            <hr class="top" />

            <div class="middle-of-post-right middle-of-post-right-share">

                <div class="caption-of-post">
                    <a href="{% url 'profile' post.poster_id %}"><img src="{{ post.poster_photo }}" alt="identity" class="profile-photo-in-topbar"></a>
                    <h3><a href="{% url 'profile' post.poster_id %}">{{ post.poster_name }}</a></h3>

                    <span>
                        <p>{{ post.caption }}</p>

                        <div>
                            <p class="age-text inside-comment-reply">{{ post.age }}</p>
                        </div>
                    </span>
                </div>

                <hr class="caption-comment" />

                <div class="comment-container">

                    {% for comment in post.comments %}

                        <div class="comment-of-post">
                            <div class="comment-portion">
                                <a href="{% url 'profile' comment.commenter_id %}"><img src="{{ comment.commenter_photo }}" alt="identity" class="profile-photo-in-topbar"></a>
                                <h3><a href="{% url 'profile' comment.commenter_id %}">{{ comment.commenter_username }}</a></h3>

                                <span class="comment-text">
                                    {{ comment.comment_text }}
                                    <br />
                                    <div>
                                        <p class="age-text inside-comment-reply">{{ comment.comment_age }}</p>
                                        <button class="age-text inside-comment-reply" onclick="like_list('{{ user_id }}','{{ comment.comment_id }}', this, 'CMNT')" >
                                            {{ comment.comment_like_count }} likes
                                        </button>
                                        <a href="#" class="age-text inside-comment-reply reply-button" onclick="commentButtonClick(document.getElementsByClassName('add-comment-in-post')[0], '{{ comment.commenter_username }}' , {{ comment.comment_id }})">Reply</a>

                                    </div>
                                </span>

                                {% csrf_token %}
                                <ul class="icons clearfix">
                                    {% if comment.comment_is_like %}
                                        <li><i class="fa fa-heart like-for-comment" aria-hidden="true" onclick="likes('{{ user_id }}','{{ comment.comment_id }}', this, 'CMNT')"></i></li>
                                    {% else %}
                                        <li><i class="fa fa-heart-o like-for-comment" aria-hidden="true" onclick="likes('{{ user_id }}','{{ comment.comment_id }}', this, 'CMNT')"></i></li>
                                    {% endif %}
                                </ul>

                                {% if comment.commenter_id == user_id or sharer_id == user_id %}
                                    {% csrf_token %}
                                    <button type="button" class="delete-button" onclick="deleteContent(this.parentElement.parentElement, {{comment.comment_id}}, 'CMNT')">
                                      <span aria-hidden="true" class="delete-button-icon">&times;</span>
                                    </button>
                                {% endif %}
                            </div>

                            {% for reply in comment.replies %}
                                <div class="reply-portion">
                                    <a href="{% url 'profile' reply.replier_id %}"><img src="{{ reply.replier_photo }}" alt="identity" class="profile-photo-in-topbar"></a>
                                    <h3><a href="{% url 'profile' reply.replier_id %}">{{ reply.replier_username }}</a></h3>

                                    <span class="reply-text">

                                        {% if reply.replied_to != -1 %}
                                            <a href="http://127.0.0.1:8000/user/{{ reply.replied_to }}" class="link-in-comment">@{{ reply.replied_to_username }}</a>
                                        {% endif %}
                                        {{ reply.reply_text }}
                                        <br />
                                        <div>
                                            <p class="age-text inside-comment-reply">{{ reply.reply_age }}</p>
                                            <button class="age-text inside-comment-reply" onclick="like_list('{{ user_id }}','{{ reply.reply_id }}', this, 'RPL')" >
                                                {{ reply.like_count }} likes
                                            </button>
                                            <a href="#" class="age-text inside-comment-reply reply-button" onclick="commentButtonClick(document.getElementsByClassName('add-comment-in-post')[0], '{{ reply.replier_username }}' , {{ comment.comment_id }})">Reply</a>

                                        </div>
                                    </span>

                                    {% csrf_token %}
                                    <ul class="icons clearfix">
                                        {% if reply.is_like %}
                                            <li><i class="fa fa-heart like-for-reply" aria-hidden="true" onclick="likes('{{ user_id }}','{{ reply.reply_id }}', this, 'RPL')"></i></li>
                                        {% else %}
                                            <li><i class="fa fa-heart-o like-for-reply" aria-hidden="true" onclick="likes('{{ user_id }}','{{ reply.reply_id }}', this, 'RPL')"></i></li>
                                        {% endif %}
                                    </ul>

                                    {% if reply.replier_id == user_id %}
                                        {% csrf_token %}
                                        <button type="button" class="delete-button" onclick="deleteContent(this.parentElement, {{reply.reply_id}}, 'RPL')">
                                          <span aria-hidden="true" class="delete-button-icon">&times;</span>
                                        </button>
                                    {% endif %}
                                </div>

                            {% endfor %}

                        <hr class="comment-separator" />
                        </div>
                    {% endfor %}

                </div>
            </div>

            <hr class="mid mid-in-share" />

            <div class="footer-of-post-right footer-of-post-right-in-share">
                {% csrf_token %}
                <ul class="icons clearfix">
                    {% if post.isLike %}
                        <li><i class="fa fa-heart like-for-post" aria-hidden="true" onclick="likes('{{user_id}}', '{{shared_id}}', this, 'SHR')"></i></li>
                    {% else %}
                        <li><i class="fa fa-heart-o like-for-post" aria-hidden="true" onclick="likes('{{user_id}}', '{{shared_id}}', this, 'SHR')"></i></li>
                    {% endif %}
                    <li><i class="fa fa-comment-o" aria-hidden="true" onclick="commentButtonClick(document.getElementsByClassName('add-comment-in-post')[0], '')"></i></li>
                    <li><i class="fa fa-paper-plane-o" aria-hidden="true" onclick="showShareCaptionWrite(document.getElementsByClassName('share-container')[0])"></i></li>
                    {% if post.isSave %}
                        <li><i class="fa fa-bookmark" aria-hidden="true" onClick="saved('{{user_id}}', '{{post.post_id}}', this)"></i></li>
                    {% else %}
                        <li><i class="fa fa-bookmark-o" aria-hidden="true" onClick="saved('{{user_id}}', '{{post.post_id}}', this)"></i></li>
                    {% endif %}
                </ul>
            </div>

            <div class="text text-in-post-view text-in-post-view-share">
                <button class="like_list_show_button" id="like_list_show_button" onclick="like_list('{{ user_id }}','{{ shared_id }}', this, 'SHR')" ><h4>
                    <b style="font-size: 20px" >{{ post.total_likes }}</b> likes</h4>
                </button>
                <p>{{ shared_age }}</p>
            </div>


                <div class="caption-of-post caption-of-post-in-share">
                    <a href="{% url 'profile' sharer_id %}"><img src="{{ sharer_profile }}" alt="identity" class="profile-photo-in-topbar"></a>
                    <h3><a href="{% url 'profile' sharer_id %}">{{ sharer_name }}</a></h3>

                    <span>
                        <p>{{shared_caption}}</p>

                        <div class="edit-caption-div clearfix edit-caption-share-div">
                            {% csrf_token %}
                            <textarea class="edit-caption-share-div-textArea"></textarea>
                            <button type="submit" onclick="changeCaption(this.parentElement.parentElement, {{ shared_id }}, 'SHR')">Done</button>
                        </div>

                        <div>
                            <p class="age-text inside-comment-reply">{{ age }}</p>
                        </div>
                    </span>

                        <div class="share-caption-div-icon">
                        {% if sharer_id == user_id %}
                            {% csrf_token %}
                            <button type="button" class="edit-button-caption" onclick="display_edit_caption_div(this.parentElement.parentElement.children[2], this)">
                                <span aria-hidden="true">
                                    <i style="font-size:24px" class="fa edit-button-icon">&#xf044;</i>
                                </span>
                            </button>

                            <button type="button" class="delete-button delete-button-caption" onclick="deleteContent(document.getElementsByClassName('caption-of-post-in-share')[0].children[2], {{shared_id}}, 'CAP', 'SHR')">
                                <span aria-hidden="true" class="delete-button-icon">&times;</span>
                            </button>
                        {% endif %}
                        </div>
                </div>


            <hr class="bottom" />

            <div class="add-comment-in-post clearfix">
                {% csrf_token %}
                <input type="text" placeholder="Add your comment" onkeyup="change_color_of_post_button(this)">
                <button type="submit" onclick="addComment(this, '{{ user_id }}', '{{ shared_id }}', 'SHR')" disabled>Post</button>
            </div>
        </div>
        <hr />
        <!-- Post section done -->

    </div>

    <!-- like list -->

    <div class="share-container">
        <div class="share-caption-div clearfix">
            {% csrf_token %}
            <textarea placeholder="Write a caption"></textarea>
            <button type="submit" onclick="sharePost({{ post_id }}, {{ user_id }}, this)">Post</button>
        </div>
        <div class="share-caption-div share-caption-div-msg">

        </div>
    </div>

    <div class="like_list_container" id="like_list_container" onclick="close_list()">
        <div class="like_list_inner_container" id="like_list_inner_container" onclick="inner_container_stop_propagation()">
            <div class="like_list_top_bar" id="like_list_top_bar">
                <h2>Likes</h2>
                <img onclick="close_list()" src="{% static 'resources/img/close.jpg'%}" >
            </div>
            <hr />
            <div class="like_list_content" id="like_list_content">
                <ul class="list_of_liked_users" id="list_of_liked_users">
                </ul>
            </div>
        </div>
    </div>

{% endblock %}
